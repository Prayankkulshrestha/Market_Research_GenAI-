from typing import List,Optional
from pydantic import BaseModel,HttpUrl,Field
from langchain_core.output_parsers import JsonOutputParser
import config
from utils import  parse_llm_json_output

parser = JsonOutputParser()




# --- Pydantic Schemas for Structured Output ---
class ProductDetail(BaseModel):
    Product_Name: str = Field(description="The exact name of the product.")
    Key_Feature: str = Field(description="The primary feature (e.g., zero-sugar, 300mg caffeine, nostalgic flavor).")
    Trending_Driver: str = Field(description="The market trend driving its popularity (e.g., fitness niche, flavor innovation).")

class ProductAnalysis(BaseModel):
    Product_Analysis: List[ProductDetail] = Field(description="A list of all unique trending products found on the page.")


# parser_with_py = JsonOutputParser(pydantic_object=TravilyResponseModel)
# with open(r"C:\Users\praku\OneDrive - Circle K Europe\Desktop\Command Prompt.txt",'r',encoding="utf-8") as f:
#     json_strin = f.read()

# parsed_output = parser.parse(json_strin)
# print(parsed_output)



output = {
    "final_product_summaries": "```oooPs_json\n[\n  {\n    \"Product_Name\": \"Bucked Up - Blood Raz\",\n    \"Key_Feature\": \"Hyper-virile-designed can, vaporous flavor ideas\",\n    \"Trending_Driver\": \"Novelty flavors\"\n  },\n  {\n    \"Product_Name\": \"Bucked Up - Rocket Pop\",\n    \"Key_Feature\": \"Hyper-virile-designed can, vaporous flavor ideas\",\n    \"Trending_Driver\": \"Novelty flavors\"\n  },\n  {\n    \"Product_Name\": \"Bucked Up - Miami\",\n    \"Key_Feature\": \"Hyper-virile-designed can, vaporous flavor ideas, attempts to imitate Pi\u00f1a Colada\",\n    \"Trending_Driver\": \"Novelty flavors, imitation of popular cocktails\"\n  },\n  {\n    \"Product_Name\": \"Ardor - Mexican lime\",\n    \"Key_Feature\": \"Delicate touch, reminiscent of La Croix, sea salt ingredient for airy edge, pithy and zesty\",\n    \"Trending_Driver\": \"Subtle flavors, perceived health benefits (sea salt)\"\n  },\n  {\n    \"Product_Name\": \"Ardor - cucumber mint\",\n    \"Key_Feature\": \"Delicate touch, reminiscent of La Croix, sea salt ingredient for airy edge\",\n    \"Trending_Driver\": \"Subtle flavors, perceived health benefits (sea salt)\"\n  },\n  {\n    \"Product_Name\": \"Ardor - vanilla blackberry\",\n    \"Key_Feature\": \"Delicate touch, reminiscent of La Croix, sea salt ingredient for airy edge\",\n    \"Trending_Driver\": \"Subtle flavors, perceived health benefits (sea salt)\"\n  },\n  {\n    \"Product_Name\": \"Guru\",\n    \"Key_Feature\": \"Plant-based energy, Coca-Cola-like botanical notes, modest calories\",\n    \"Trending_Driver\": \"Natural ingredients, wellness focus, unique flavor profile\"\n  },\n  {\n    \"Product_Name\": \"Ghost - Sour Patch Kids blue raspberry\",\n    \"Key_Feature\": \"Bright yellow can, demonic mascot, candy-inspired collaborations\",\n    \"Trending_Driver\": \"Brand collaborations, appeal to younger generations, candy flavors\"\n  },\n  {\n    \"Product_Name\": \"Ghost - cherry limeade\",\n    \"Key_Feature\": \"Bright yellow can, demonic mascot, candy-inspired collaborations\",\n    \"Trending_Driver\": \"Brand collaborations, appeal to younger generations, candy flavors\"\n  },\n  {\n    \"Product_Name\": \"BeGOAT - hibiscus lime\",\n    \"Key_Feature\": \"Clean alternative, 200mg caffeine from cascara, antioxidants, polyphenols, stevia sweetness\",\n    \"Trending_Driver\": \"Health-conscious positioning, natural caffeine sources, low calorie\"\n  },\n  {\n    \"Product_Name\": \"C4 - blood orange yuzu\",\n    \"Key_Feature\": \"Aimed at gym rats, candy-inspired collaborations, proprietary flavors\",\n    \"Trending_Driver\": \"Fitness market, unique flavor combinations, brand extensions\"\n  },\n  {\n    \"Product_Name\": \"Reign Total Body Fuel - sour gummy worm\",\n    \"Key_Feature\": \"Conjoins jock imagery with mind-boggling flavor offerings\",\n    \"Trending_Driver\": \"Fitness market, novelty flavors, broad appeal\"\n  },\n  {\n    \"Product_Name\": \"Reign Total Body Fuel - white gummy bear\",\n    \"Key_Feature\": \"Conjoins jock imagery with mind-boggling flavor offerings\",\n    \"Trending_Driver\": \"Fitness market, novelty flavors, broad appeal\"\n  },\n  {\n    \"Product_Name\": \"Reign Total Body Fuel - rainbow sherbet\",\n    \"Key_Feature\": \"Conjoins jock imagery with mind-boggling flavor offerings, complex flavor profile\",\n    \"Trending_Driver\": \"Fitness market, novelty flavors, complex flavor profiles\"\n  },\n  {\n    \"Product_Name\": \"Reign Total Body Fuel - red dragon\",\n    \"Key_Feature\": \"Conjoins jock imagery with mind-boggling flavor offerings\",\n    \"Trending_Driver\": \"Fitness market, novelty flavors, broad appeal\"\n  },\n  {\n    \"Product_Name\": \"Celsius - green apple cherry\",\n    \"Key_Feature\": \"Low-calorie, wellness-coated product, health claims (metabolism acceleration)\",\n    \"Trending_Driver\": \"Wellness trend, low calorie, perceived health benefits\"\n  },\n  {\n    \"Product_Name\": \"Rockstar\",\n    \"Key_Feature\": \"Tropical fruit and bubblegum aroma, intense but pleasant sweetness, distinct personality\",\n    \"Trending_Driver\": \"Established brand recognition, bold flavor profiles\"\n  },\n  {\n    \"Product_Name\": \"Nos\",\n    \"Key_Feature\": \"Flavor crashes on the tongue with sharp passion fruit, pineapple, and mango undertones, aggressive profile\",\n    \"Trending_Driver\": \"Bold flavors, association with thrill-seeking culture\"\n  },\n  {\n    \"Product_Name\": \"Bang - Blue Razz\",\n    \"Key_Feature\": \"Zero calories, candy-like but not crushing sweetness, airy and perfectly carbonated fizz\",\n    \"Trending_Driver\": \"Zero calorie, candy flavors, nostalgic appeal\"\n  },\n  {\n    \"Product_Name\": \"Bang - Delish Strawberry Kiss\",\n    \"Key_Feature\": \"Zero calories, candy-like but not crushing sweetness, airy and perfectly carbonated fizz\",\n    \"Trending_Driver\": \"Zero calorie, candy flavors, nostalgic appeal\"\n  },\n  {\n    \"Product_Name\": \"Prime - original\",\n    \"Key_Feature\": \"Bro-ey appeal, solely sweet without distinguishing attributes, hint of lemon pepper\",\n    \"Trending_Driver\": \"Influencer marketing, broad appeal, simple sweetness\"\n  },\n  {\n    \"Product_Name\": \"Prime - lemon-lime\",\n    \"Key_Feature\": \"Shines brightest in citrus category, bro-ey appeal\",\n    \"Trending_Driver\": \"Influencer marketing, citrus flavors, broad appeal\"\n  },\n  {\n    \"Product_Name\": \"Prime - strawberry watermelon\",\n    \"Key_Feature\": \"Bro-ey appeal\",\n    \"Trending_Driver\": \"Influencer marketing, fruit flavors, broad appeal\"\n  },\n  {\n    \"Product_Name\": \"Riot - citrus lime\",\n    \"Key_Feature\": \"Near-flawless compromise, refreshing, easily-readable punchy and acidic notes, biting edge\",\n    \"Trending_Driver\": \"Balanced flavor profile, refreshing taste, acidity\"\n  },\n  {\n    \"Product_Name\": \"Riot - strawberry lemonade\",\n    \"Key_Feature\": \"Near-flawless compromise, refreshing, easily-readable punchy and acidic notes\",\n    \"Trending_Driver\": \"Balanced flavor profile, refreshing taste, fruit flavors\"\n  },\n  {\n    \"Product_Name\": \"Ghost - Sour Patch Kids Redberry\",\n    \"Key_Feature\": \"Partnership with candy brands, wide range of flavors, 200mg caffeine, 1000mg taurine, sugar-free with sucralose.\",\n    \"Trending_Driver\": \"Nostalgia marketing, appealing to sweet tooth, broad flavor appeal through collaborations.\"\n  },\n  {\n    \"Product_Name\": \"Red Bull - Original\",\n    \"Key_Feature\": \"Category inventor, top-seller, 80mg caffeine, 29g sugar, 110 calories.\",\n    \"Trending_Driver\": \"Brand recognition, established market presence, classic flavor.\"\n  },\n  {\n    \"Product_Name\": \"Monster Energy - White Pineapple\",\n    \"Key_Feature\": \"Offers a range of flavors, 16oz can, amplified caffeine content.\",\n    \"Trending_Driver\": \"Variety of flavors, larger serving size, strong brand identity.\"\n  },\n  {\n    \"Product_Name\": \"Monster Energy - Peaches N\u2019 Cream\",\n    \"Key_Feature\": \"Offers a range of flavors, 16oz can, amplified caffeine content.\",\n    \"Trending_Driver\": \"Variety of flavors, larger serving size, strong brand identity.\"\n  },\n  {\n    \"Product_Name\": \"Monster Energy - OG\",\n    \"Key_Feature\": \"Original flavor (black can, green lettering), 160mg caffeine, 58g sugar, 230 calories.\",\n    \"Trending_Driver\": \"Iconic branding, higher sugar content for a sweet taste, strong market position.\"\n  },\n  {\n    \"Product_Name\": \"C4 - Frozen Bombsicle\",\n    \"Key_Feature\": \"Sport and fitness focus, zero sugar, zero carbs, low calorie, 200mg caffeine, infused with beta-alanine.\",\n    \"Trending_Driver\": \"Health-conscious consumers, performance enhancement, fitness community appeal.\"\n  },\n  {\n    \"Product_Name\": \"Celsius - Sparkling Orange\",\n    \"Key_Feature\": \"Fitness-focused, third top-selling in US, 27 flavors, 200mg caffeine, B vitamins, low calorie.\",\n    \"Trending_Driver\": \"Health and wellness trend, fitness enthusiast appeal, refreshing taste profile.\"\n  },\n  {\n    \"Product_Name\": \"Alani Nu - Cherry Slush\",\n    \"Key_Feature\": \"Founded by fitness influencer, 200mg caffeine, B vitamins, 12oz can, zero sugar, low calorie.\",\n    \"Trending_Driver\": \"Influencer marketing, strong appeal to younger demographic, nostalgic flavor profile.\"\n  }\n]\n```"
  }
product_summary = output["final_product_summaries"]
try:
    output = parse_llm_json_output(product_summary)
except Exception as e:
    print("error in parsing")
finally:
    output = product_summary
print(output)